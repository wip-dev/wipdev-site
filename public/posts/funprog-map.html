<!DOCTYPE html><html><head><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/hybrid.min.css" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/clojure.min.js"></script><link href="/styles.css" rel="stylesheet" /><title>(wipdev-blog)</title></head><body><main><h1>Functional Programming: map</h1><p>One of the famous functional programming concepts is <a href='https://en.wikipedia.org/wiki/Higher-order_function#R'>higher-order functions</a>, which are functions that either take functions as input or return functions as output. <code>map</code> is one of the most popular higher-order functions, and also one of the most useful. You can find it in popular languages like <a href='https://docs.python.org/3.8/library/functions.html#map'>Python</a> and <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map'>JavaScript</a>. R also has many variants of <code>map</code>.</p><p>This tutorial will explain <code>map</code> in general and give an overview of available implementations in R. For a more detailed look, I recommend reading the <a href='https://r4ds.had.co.nz/iteration.html'>R for Data Science chapter on iteration</a>.</p><p><img src="https://i.imgur.com/whX7R8m.png" alt="map" /> (Image source: <a href='http://keitheis.github.io/reactive-programming-in-python/'>http://keitheis.github.io/reactive-programming-in-python/</a>)</p><h2>What is <code>map</code>?</h2><p>To put it shortly, <code>map</code> takes a function and a collection (e.g. list) as input, <i>calls the function on each element of the collection</i>, then returns as output a new collection of the results of such calls.</p><p>Let's say that I have:</p><ul><li>a function <code>increment</code> that simply takes a number and adds 1 to it</li><li>a colelction of numbers from 1 to 5</li></ul><p>Calling <code>map</code> with the function <code>increment</code> and the number list will give back a new list of numbers from 2 to 6.</p><h2>Why is it useful?</h2><p>Anyone familiar with basic programming concepts should think of <code>for</code> loops when they want to iterate over a collection. But <code>for</code> loops contain too much code boilerplate and also requires initializing new variables like the "i" that gets incremented with each iteration and an empty collection that will take the new results. So, <code>map</code> is more concise and elegant than for loops.</p><p><strong>Side note:</strong> this constrast is basically the difference between <a href='https://en.wikipedia.org/wiki/Declarative_programming'>declarative programming</a> and <a href='https://en.wikipedia.org/wiki/Imperative_programming'>imperative programming</a>, where the former says <i>what</i> the programmer wants to do and the latter explains to the computer more low-level steps on <i>how</i> to do it.</p><h2>How to implement it in R?</h2><p>Using <code>map</code>-like functions while using R in a statistics/data science setting is almost always about iterating with some function over columns of a data frame. The base R option for iterating (with a function) over columns of a data frame is the function <code>sapply&#40;&#41;</code>.</p><p>For example, one quick way to identify the column types without having to print a lot of extra output, like <code>str&#40;&#41;</code> or <code>summary&#40;&#41;</code>, is by doing something like this:</p><pre><code class="r">sapply&#40;iris, class&#41;

# Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species
#    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;     &quot;factor&quot;
</code></pre><p>So, I applied the function <code>class&#40;&#41;</code> on each column of the data frame <code>iris</code> and got a simple output of the class (data type) of every column. The same thing can be done with <code>mean&#40;&#41;</code> or any other function that <i>expects a vector</i> (remember that iterating one each column means iterating on individual vectors).</p><pre><code class="r">sapply&#40;iris, mean&#41;

# Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species
#     5.843333     3.057333     3.758000     1.199333           NA
</code></pre><p>Notice that the parentheses are not written because I am not <i>calling</i> the function &ndash; I am <i>passing</i> it as an argument.</p><p>Another direct equivalent for this purpose is <code>purrr::map&#40;&#41;</code>. It behaves almost the same, except the following:</p><ul><li><code>map&#40;&#41;</code> returns a list instead of the behavior of <code>sapply&#40;&#41;</code> which tries to  "simplify" the output into a vector.</li><li>The package <code>purrr</code> has a set of <code>map&#95;&#42;</code> functions that enforce certain  output types: <code>map&#95;dbl&#40;&#41;</code> ensures the output is a double (numeric) vector,  <code>map&#95;df&#40;&#41;</code> ensures the output is a data frame, and so on.<pre><code class="r">iris&#95;means &lt;- map&#40;iris, mean&#41;
class&#40;iris&#95;means&#41;

# &#91;1&#93; &quot;list&quot;

iris&#95;means

# $Sepal.Length
# &#91;1&#93; 5.843333
#
# $Sepal.Width
# &#91;1&#93; 3.057333
#
# $Petal.Length
# &#91;1&#93; 3.758
#
# $Petal.Width
# &#91;1&#93; 1.199333
#
# $Species
# &#91;1&#93; NA
</code></pre><pre><code class="r">iris&#95;means&#95;dbl &lt;- map&#95;dbl&#40;iris, mean&#41;
class&#40;iris&#95;means&#95;dbl&#41;

# &#91;1&#93; &quot;numeric&quot;

iris&#95;means&#95;dbl

# Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species
#     5.843333     3.057333     3.758000     1.199333           NA
</code></pre></li></ul><h2>Anonymous functions</h2><p>Sometimes the function you want to map over columns is not already defined with a name. In this case, you have to write your own function. But instead of defining a function in your script and using it only once in your iteration code, you could actually write an <i>anonymous function</i> as the function argument to <code>sapply&#40;&#41;</code> or <code>map&#40;&#41;</code>. If you are familiar with writing your own functions, it is the same except that you do not assign that function to a variable.</p><p>See this example:</p><pre><code class="r">sapply&#40;iris,
       function&#40;var&#41; { is.numeric&#40;var&#41; | is.character&#40;var&#41; }&#41;

# Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species
#         TRUE         TRUE         TRUE         TRUE        FALSE
</code></pre><p>I wrote a function that returns <code>TRUE</code> if the variable is a numeric or character vector. That function has no name (i.e. anonymous) and will only be used in the <code>sapply&#40;&#41;</code> call.</p><p>Now <code>purrr</code> has special syntax for writing anonymous functions. While the previously described syntax is perfectly valid for <code>map&#40;&#41;</code>, the special syntax provided by <code>purrr</code> is more concise if you would prefer learning and using it.</p><pre><code class="r">map&#95;lgl&#40;iris,
        &#126; is.numeric&#40;.x&#41; | is.character&#40;.x&#41;&#41;

# Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species
#         TRUE         TRUE         TRUE         TRUE        FALSE
</code></pre><p>The anonymous function syntax here starts with a tilde followed by your own function body, using "<code>.x</code>" as the argument.</p><h2>Bonus: <code>map</code> in Python and JavaScript</h2><ul><li>Python:<pre><code class="python">list&#40;map&#40;lambda x: x + 1, &#91;1, 2, 3, 4, 5&#93;&#41;&#41;

# &#91;2, 3, 4, 5, 6&#93;
</code></pre></li><li>JavaScript:<pre><code class="javascript">&#91;1, 2, 3, 4, 5&#93;.map&#40;&#40;x&#41; =&gt; x + 1&#41;;

// &#91;2, 3, 4, 5, 6&#93;
</code></pre></li></ul><p>I personally like JavaScript's arrow function syntax for writing anonymous functions.</p><hr/><p>So, this was <code>map</code>! The concept behind it is relatively simple but really elegant, and it should save you a lot of time and code duplication if you get to use it often. Also, since it is a popular concept and already implemented in major languages, you can easily transfer your knowledge between languages.</p></main><aside><pre><code>(wipdev-blog)</code></pre><ul><li><a href="/">Home/About</a></li><li><a href="/posts">Articles</a></li></ul></aside><script src="/main.js"></script></body></html>