<!DOCTYPE html><html><head><link href="/styles.css" rel="stylesheet" /></head><body><article>title: "Automating Git With Python"date: 2020-09-16T10:53:36+02:00Description: "Sharing a Python script that I wrote to update my website's Git repo."Tags: ["Python", "Coding"]Categories: ["Blog"]<h2>DisableComments: false</h2><p>Programmers are lazy! This is why I wrote a Python script to write one command instead of three in my Git workflow.</p><h1>Context</h1><p>This website is made with the static site generator <a href='https://gohugo.io/'>Hugo</a>. Once the layout and theme of the site are chosen, all I needed then was writing new posts. This is done by writing Markdown documents. I also have it version-controlled so that I can host it on <a href='https://www.netlify.com/'>Netlify</a> through the GitHub repo.</p><p>So this is what happens with the repo after writing every new post:</p><ul><li><code>git add .</code> (it's only one new file added to the repo)</li><li><code>git commit -m &quot;my commit message&quot;</code></li><li><code>git push</code></li></ul><p>It is a repetitive task, and it is exactly the same except for the commit message. Sounds like a perfect candidate for an automation script! (Also, a fun Python exercise.)</p><h1>The code</h1><p>Here's the whole script:</p><pre><code class="python">#! /usr/bin/python3
from git import Repo, GitCommandError
import sys

if len&#40;sys.argv&#41; &lt; 2:
    print&#40;&quot;No message given... exiting&quot;&#41;
    sys.exit&#40;&#41;
else:
    commit&#95;msg = sys.argv&#91;1&#93;

repo = Repo&#40;&quot;.&quot;&#41;
repo.git.add&#40;&quot;--all&quot;&#41;

try:
    repo.git.commit&#40;&quot;-m&quot;, commit&#95;msg&#41;
    print&#40;f&quot;Successfully added commit: \&quot;{commit&#95;msg}\&quot;&quot;&#41;
except GitCommandError:
    print&#40;&quot;Nothing to commit... exiting&quot;&#41;
    sys.exit&#40;&#41;

try:
    origin = repo.remote&#40;&#41;
    origin.pull&#40;&#41;
    print&#40;&quot;Successfully pulled!&quot;&#41;
    origin.push&#40;&#41;
    print&#40;&quot;Successfully pushed!&quot;&#41;
except:
    print&#40;&quot;Problem with pushing... exiting&quot;&#41;
    sys.exit&#40;&#41;
</code></pre><p>If you know a bit of Python and Git, you can very easily understand it. It could have been more complicated to work in more use cases, but I did what would help me with the exact repetition mentioned above.</p><p>The script is meant to be executed from the (Linux) shell, where I normally run the Git commands, and takes the commit message as an argument:</p><pre><code class="bash">./the&#95;script.py &quot;my commit message&quot;
</code></pre><h2>Guards</h2><p>I have put in some defensive code to avoid crashes or bad commits:</p><ul><li>Checking for the commit message argument so that the script exits if I  forget to add the message to the execution command.</li><li>Handling the exception that is raised when there is nothing to commit. This  way the scripts prints a simple message instead of a Python traceback.</li><li>Similar behavior with pushing.</li></ul><h2>Assumptions</h2><p>The script is far from perfect and, like I said, more can be done. But it works for my specific use case:</p><ul><li>The repo and its remote are already set up.</li><li>It commits all files (which is almost always one in my case).</li><li>It doesn't care about branches (I commit to and push the master branch).</li></ul><h1>Repos</h1><p>I have this script, and <a href='/post/automating-git-with-r/'>a similar one written in R</a> on GitHub:</p><ul><li>Python: https://github.com/waseem-medhat/git_done</li><li>R: https://github.com/waseem-medhat/git_doneR<h2></h2></li></ul><p>That's it! The idea is really simple but kinda cool. I am glad I was able to write a script like this in an hour and have a Python workout in the process. Now, I can update my website with one single command after writing this post and the next ones!</p><p><strong>Edit</strong>: I added a <code>git pull</code> command to the code. While my workflow so far has the code only going in one direction, pulling is best practice. Thanks to David Kun for the suggestion.</p></article></body></html>